SELECT X.BR_NO,
       X.DG_NK,
       SUM (CASE WHEN X.OVERRIDE_TYPE = 'P' THEN 1 ELSE 0 END) PROD_CCOR,
       SUM (CASE WHEN X.OVERRIDE_TYPE = 'G' THEN 1 ELSE 0 END) GROUP_CCOR,
       SUM (CASE WHEN X.OVERRIDE_TYPE = 'C' THEN 1 ELSE 0 END) COST_CCOR
  FROM (SELECT CCOR.BRANCH_NUMBER_NK BR_NO,
               PROD.ALT1_CODE,
               CCOR.CUSTOMER_GK,
               TO_NUMBER (PROD.DISCOUNT_GROUP_GK) DG_NK,
               CCOR.OVERRIDE_TYPE
          FROM    DW_FEI.CUSTOMER_OVERRIDE_DIMENSION CCOR
               INNER JOIN
                  DW_FEI.PRODUCT_DIMENSION PROD
               ON (CCOR.MASTER_PRODUCT = PROD.PRODUCT_NK)
         WHERE     (CCOR.BRANCH_NUMBER_NK = '520')
               AND (CCOR.OVERRIDE_TYPE = 'P')
               AND (CCOR.DELETE_DATE IS NULL)
        UNION
        SELECT CCOR.BRANCH_NUMBER_NK BR_NO,
               NULL AS ALT1_CODE,
               CCOR.CUSTOMER_GK,
               TO_NUMBER (CCOR.DISC_GROUP) DG_NK,
               CCOR.OVERRIDE_TYPE
          FROM DW_FEI.CUSTOMER_OVERRIDE_DIMENSION CCOR
         WHERE     (CCOR.BRANCH_NUMBER_NK = '520')
               AND (CCOR.OVERRIDE_TYPE = 'G')
               AND (CCOR.DELETE_DATE IS NULL)
        UNION
        SELECT CCOR.BRANCH_NUMBER_NK BR_NO,
               PROD.ALT1_CODE,
               CCOR.CUSTOMER_GK,
               TO_NUMBER (PROD.DISCOUNT_GROUP_NK) DG_NK,
               CCOR.OVERRIDE_TYPE
          FROM (   DW_FEI.CUSTOMER_OVERRIDE_DIMENSION CCOR
                INNER JOIN
                   DW_FEI.PRODUCT_DIMENSION PROD
                ON (CCOR.MASTER_PRODUCT = PROD.PRODUCT_NK))
         WHERE     (CCOR.BRANCH_NUMBER_NK = '520')
               AND (CCOR.OVERRIDE_TYPE = 'C')
               AND (CCOR.DELETE_DATE IS NULL)) X
GROUP BY X.BR_NO, X.DG_NK;

-- Statement	10/30/2015 9:55:24 AM	0:00:12.433	Query OK	1	0