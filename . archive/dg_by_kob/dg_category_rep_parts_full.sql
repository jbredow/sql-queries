SELECT IHF.ACCOUNT_NUMBER,
	BC.ACCOUNT_NAME,
	ILF.YEARMONTH,
	PROD.DISCOUNT_GROUP_NK,
	CASE
		WHEN IHF.CHANNEL_TYPE IN ('H3', 'H7', 'O3', 'O7')
		THEN 'Direct'
    ELSE 'Stock'
	END AS CHANNEL,
	SUM(ILF.EXT_SALES_AMOUNT),
	SUM(ILF.EXT_AVG_COGS_AMOUNT)
FROM DW_FEI.INVOICE_LINE_FACT ILF
	INNER JOIN DW_FEI.INVOICE_HEADER_FACT IHF
		ON IHF.INVOICE_NUMBER_GK = ILF.INVOICE_NUMBER_GK
	INNER JOIN DW_FEI.CUSTOMER_DIMENSION CUST
		ON IHF.CUSTOMER_ACCOUNT_GK = CUST.CUSTOMER_GK
	INNER JOIN AAA6863.BRANCH_CONTACTS BC
		ON CUST.ACCOUNT_NUMBER_NK = BC.ACCOUNT_NK
	INNER JOIN DW_FEI.PRODUCT_DIMENSION PROD
		ON ILF.PRODUCT_NUMBER_NK = PROD.PRODUCT_NK
WHERE BC.DISTRICT IN ('C10', 'C11', 'C12')
	AND ILF.YEARMONTH BETWEEN 	TO_CHAR(TRUNC(SYSDATE - 
										NUMTOYMINTERVAL(12, 'MONTH'), 'MONTH'), 'YYYYMM') 
						  AND   TO_CHAR(TRUNC(SYSDATE, 'MM') - 1, 'YYYYMM')
	AND IHF.YEARMONTH BETWEEN   TO_CHAR(TRUNC(SYSDATE - 
										NUMTOYMINTERVAL(12, 'MONTH'), 'MONTH'), 'YYYYMM') 
	                      AND TO_CHAR(TRUNC(SYSDATE, 'MM') - 1, 'YYYYMM')
	AND DECODE (PROD.DISCOUNT_GROUP_NK, 
						'407', 1,	'567', 1,	'618', 1,	'626', 1,	'641', 1,	'696', 1,
						'727', 1,	'737', 1,	'789', 1,	'790', 1,	'803', 1,	'883', 1,
						'905', 1,	'915', 1,	'952', 1,	'971', 1,	'1095', 1,	'1227', 1,
						'1356', 1,	'1358', 1,	'1496', 1,	'1564', 1,	'1565', 1,	'1623', 1,
						'1630', 1,	'1633', 1,	'1674', 1,	'1686', 1,	'1762', 1,	'1811', 1,
						'1848', 1,	'1849', 1,	'1890', 1,	'1893', 1,	'1895', 1,	'1905', 1,
						'1915', 1,	'1952', 1,	'2106', 1,	'2233', 1,	'2284', 1,	'2307', 1,
						'2429', 1,	'2451', 1,	'2458', 1,	'2483', 1,	'2485', 1,	'2539', 1,
						'2555', 1,	'2589', 1,	'2639', 1,	'2714', 1,	'2749', 1,	'2888', 1,
						'2971', 1,	'2988', 1,	'3031', 1,	'3033', 1,	'3037', 1,	'3047', 1,
						'3052', 1,	'3095', 1,	'3115', 1,	'3158', 1,	'3193', 1,	'3196', 1,
						'3203', 1,	'3286', 1,	'3287', 1,	'3309', 1,	'3337', 1,	'3346', 1,
						'3349', 1,	'3352', 1,	'3402', 1,	'3406', 1,	'3410', 1,	'3413', 1,
						'3414', 1,	'3417', 1,	'3419', 1,	'3422', 1,	'3432', 1,	'3682', 1,
						'3683', 1,	'3698', 1,	'3709', 1,	'3733', 1,	'3735', 1,	'3742', 1,
						'3767', 1,	'3781', 1,	'3785', 1,	'3800', 1,	'3810', 1,	'3822', 1,
						'3828', 1,	'3845', 1,	'3846', 1,	'3849', 1,	'3851', 1,	'3854', 1,
						'3855', 1,	'3856', 1,	'3861', 1,	'3864', 1,	'3865', 1,	'3866', 1,
						'3873', 1,	'3892', 1,	'3896', 1,	'3897', 1,	'3898', 1,	'3899', 1,
						'3901', 1,	'3903', 1,	'3904', 1,	'3905', 1,	'3915', 1,	'3917', 1,
						'3921', 1,	'3949', 1,	'3950', 1,	'3951', 1,	'3953', 1,	'3954', 1,
						'3973', 1,	'3977', 1,	'3980', 1,	'3991', 1,	'3996', 1,	'3998', 1,
						'4058', 1,	'4079', 1,	'4091', 1,	'4098', 1,	'4111', 1,	'4114', 1,
						'4115', 1,	'4126', 1,	'4164', 1,	'4167', 1,	'4190', 1,	'4199', 1,
						'4232', 1,	'4235', 1,	'4242', 1,	'4275', 1,	'4280', 1,	'4285', 1,
						'4309', 1,	'4312', 1,	'4328', 1,	'4340', 1,	'4363', 1,	'4432', 1,
						'4447', 1,	'4449', 1,	'4503', 1,	'4537', 1,	'4542', 1,	'4549', 1,
						'4558', 1,	'4568', 1,	'4572', 1,	'4578', 1,	'4606', 1,	'4741', 1,
						'4762', 1,	'4781', 1,	'4802', 1,	'4803', 1,	'4818', 1,	'4841', 1,
						'4844', 1,	'4852', 1,	'4902', 1,	'4907', 1,	'4908', 1,	'4918', 1,
						'4947', 1,	'4955', 1,	'4979', 1,	'5019', 1,	'5028', 1,	'5030', 1,
						'5049', 1,	'5061', 1,	'5063', 1,	'5067', 1,	'5101', 1,	'5123', 1,
						'5127', 1,	'5140', 1,	'5141', 1,	'5154', 1,	'5171', 1,	'5174', 1,
						'5189', 1,	'5192', 1,	'5209', 1,	'5231', 1,	'5240', 1,	'5245', 1,
						'5268', 1,	'5271', 1,	'5277', 1,	'5287', 1,	'5350', 1,	'5351', 1,
						'5355', 1,	'5357', 1,	'5371', 1,	'5387', 1,	'5397', 1,	'5402', 1,
						'5458', 1,	'5565', 1,	'5566', 1,	'5576', 1,	'5634', 1,	'5654', 1,
						'5673', 1,	'5695', 1,	'5698', 1,	'5709', 1,	'5719', 1,	'5734', 1,
						'5761', 1,	'5777', 1,	'5830', 1,	'5996', 1,	'6026', 1,	'6046', 1,
						'6075', 1,	'6117', 1,	'6148', 1,	'6178', 1,	'6205', 1,	'6211', 1,
						'6223', 1,	'6263', 1,	'6268', 1,	'6292', 1,	'6298', 1,	'6326', 1,
						'6335', 1,	'6346', 1,	'6358', 1,	'6367', 1,	'6456', 1,	'6498', 1,
						'6501', 1,	'6503', 1,	'6505', 1,	'6628', 1,	'6652', 1,	'6715', 1,
						'6720', 1,	'6750', 1,	'6796', 1,	'6813', 1,	'6817', 1,	'6858', 1,
						'6893', 1,	'7509', 1,	'7532', 1,	'7585', 1,	'7661', 1,	'7805', 1,
						'7933', 1,	'7935', 1,	'8010', 1,	'8132', 1,	'8209', 1,	'8371', 1,
						'8372', 1,	'8373', 1,	'8382', 1,	'8422', 1,	'8433', 1,	'8449', 1,
						'8452', 1,	'8506', 1,	'8516', 1,	'8696', 1,	'8784', 1,	'8797', 1,
						'8810', 1,	'8832', 1,	'8933', 1,	'8934', 1,	'8935', 1,	'8936', 1,
						'8943', 1,	'9511', 1,	'9719', 1,	'9825', 1, 0) = 0		

GROUP BY IHF.ACCOUNT_NUMBER,
	BC.ACCOUNT_NAME,
	ILF.YEARMONTH,
	PROD.DISCOUNT_GROUP_NK,
	CASE
		WHEN IHF.CHANNEL_TYPE IN ('H3', 'H7', 'O3', 'O7')
		THEN 'Direct'
		ELSE 'Stock'
	END,
	IHF.CHANNEL_TYPE
	;