--STEP 1
--BUILD OUT PRODUCT FILE FOR SELECT LIST OF DGS
--CHANGE TO YOUR PERSONAL SCHEMA
--CHANGE OR REMOVE DG LIST TO REPRESTENT COMPLETE DIST PRODUCT AVAILABILITY

TRUNCATE TABLE AAD9606.PR_NONBR_WPF;

INSERT INTO AAD9606.PR_NONBR_WPF
   (SELECT *
    FROM (SELECT DPP."KEY"
                    PRODUCT_NK,
                 DPP.ALT1,
                 DPP.VENCODE,
                 DPP."DESC"
                    PRODUCT_DESC,
                 DPP.LINE,
                 DPP."GROUP"
                    DISCOUNT_GROUP_NK,
                 COUNT (DISTINCT DPP.WHSE)
                    WHSES,
                 SUM (DPP.DEMAND)
                    DEMAND,
                 SUM (DPP.ONHAND)
                    ONHAND,
                 SUM (DPP.AVAIL)
                    AVAIL,
                 SUM (DPP.NETAVAIL)
                    NETAVAIL,
                 MAX (DPP.AVGCOST)
                    AVGCOST,
                 DPP.OBSOLETE,
                 DPP.PER,
                 STATS_MODE (DPP.PPQ1)
                    PPQ1,
                 STATS_MODE (DPP.PPQ2)
                    PPQ2,
                 STATS_MODE (DPP.PPQ3)
                    PPQ3,
                 MAX (DPP.REPCOST)
                    REPCOST,
                 DPP.LISTPRICE
                    LIST_PR,
                 DPP.BASIS1,
                 DPP.BASIS2,
                 DPP.BASIS3,
                 DPP.BASIS4,
                 DPP.BASIS5,
                 DPP.BASIS6,
                 MAX (DPP.BASIS7)
                    BASIS7,
                 MAX (DPP.BASIS8)
                    BASIS8,
                 MAX (DPP.BASIS9)
                    BASIS9,
                 CASE
                    WHEN COALESCE (LTRIM (RTRIM (STATUS)), 'ST') IN
                            ('ST', 'NQ', 'S')
                    THEN
                       'DC_STOCK'
                    WHEN     WHSE = '39'
                         AND "KEY" NOT IN
                                (SELECT DISTINCT "KEY"
                                 FROM SALES_MART.DIST_PRODUCT_PRICING
                                 WHERE COALESCE (LTRIM (RTRIM (STATUS)),
                                                 'ST') IN
                                          ('ST', 'NQ', 'S'))
                    THEN
                       'SOD'
                    ELSE
                       NULL
                 END
                    ORDER_METHOD
          FROM SALES_MART.DIST_PRODUCT_PRICING DPP
          WHERE     COALESCE (LTRIM (RTRIM (STATUS)), 'ST') IN ('ST',
                                                                'NQ',
                                                                'S',
                                                                'T')
                AND "GROUP" NOT IN ('9999', 'SP')
          ---- ************* SPECIFY LIST OF DGS OR LEAVE OUT FOR WHOLE BOOK ******************
          /*  AND "GROUP" IN ('4685',
                            '4688',
                            '4686',
                            '4690',
                            '4617',
                            '4687',
                            '4658',
                            '4671',
                            '4692',
                            '1258',
                            '1260',
                            '1259',
                            '1257',
                            '1262',
                            '1261',
                            '4786',
                            '4791',
                            '4778',
                            '5333',
                            '5756',
                            '4786',
                            '4787',
                            '4791',
                            '0032',
                            '0772',
                            '0800',
                            '0869',
                            '0870',
                            '2569',
                            '2578',
                            '2598',
                            '2745',
                            '0709',
                            '0813',
                            '0911',
                            '0915',
                            '0976',
                            '1513',
                            '2563',
                            '2567',
                            '2568',
                            '2568',
                            '2572',
                            '2586',
                            '2594',
                            '8594',
                            '9295',
                            '0774',
                            '0866',
                            '0910',
                            '0937',
                            '0975',
                            '2567',
                            '2570',
                            '2577',
                            '2579',
                            '2586',
                            '2587',
                            '2596',
                            '2597',
                            '2748',
                            '0698',
                            '0573',
                            '0836',
                            '2550',
                            '2551',
                            '2556',
                            '2561',
                            '2582',
                            '2583',
                            '2584',
                            '2585',
                            '2599',
                            '2605',
                            '2746',
                            '6027',
                            '9294',
                            '0913',
                            '0956',
                            '2565',
                            '2566',
                            '2572',
                            '2585',
                            '2590',
                            '2602',
                            '0900',
                            '0908',
                            '2563',
                            '2564',
                            '2573',
                            '2574',
                            '2576',
                            '2581',
                            '2589',
                            '2592',
                            '2593',
                            '2600',
                            '2601',
                            '8590',
                            '0702',
                            '0708',
                            '0916',
                            '0976',
                            '2557',
                            '2558',
                            '2590',
                            '2604',
                            '8592',
                            '0775',
                            '0837',
                            '0909',
                            '0912',
                            '2555',
                            '2556',
                            '2557',
                            '2562',
                            '2569',
                            '2571',
                            '2575',
                            '2578',
                            '2581',
                            '2588',
                            '2595',
                            '2606',
                            '2744',
                            'B834',
                            'B872',
                            '4066',
                            '4062',
                            '4076',
                            '4058',
                            '4064',
                            '1070',
                            '1098',
                            '1106',
                            '1061',
                            '1067',
                            '1082',
                            '1107',
                            '1062',
                            '1063',
                            '1258',
                            '1068',
                            '1077',
                            '1080',
                            '1084',
                            '1104',
                            '1076',
                            '1113',
                            '1072',
                            '1107',
                            '1066',
                            '1434',
                            '1422',
                            '1438',
                            '7203',
                            '7227',
                            '1420',
                            '1421',
                            '7206',
                            '7210',
                            '7222',
                            '7211',
                            '7228',
                            '7234',
                            '1424',
                            '1423',
                            '1432',
                            '7221',
                            '7230',
                            '7232',
                            '1407',
                            '1436',
                            '1450',
                            '7204',
                            '7237',
                            '7238',
                            '7242',
                            '7215',
                            '7209',
                            '7214',
                            '1433',
                            '1435',
                            '7216',
                            '7217',
                            '7236',
                            '7240',
                            '7245',
                            '7113',
                            '7117',
                            '0549',
                            '0550',
                            '0559',
                            '0574',
                            '0585',
                            '0545',
                            '0565',
                            '0540',
                            '0565',
                            '0551',
                            '0556',
                            '3668',
                            '3675',
                            '3677',
                            '3670',
                            '3671',
                            '1330',
                            '3659',
                            '3664',
                            '3687',
                            '3672',
                            'B811',
                            '3666',
                            '3667',
                            '3669',
                            '3674',
                            '3665',
                            '3678',
                            '1329',
                            '1387',
                            '3669',
                            '3689',
                            '4108',
                            '4108',
                            '4079',
                            '0745',
                            '0786',
                            '0846',
                            '0853',
                            '1304',
                            '1314',
                            '1317',
                            '0849',
                            '1289',
                            '1293',
                            '1299',
                            '4833',
                            '4862',
                            '8358',
                            '853',
                            'A803',
                            'A808',
                            'B300',
                            '5968',
                            '0850',
                            '0865',
                            '1069',
                            '1274',
                            '1278',
                            '1279',
                            '1286',
                            '1303',
                            '1312',
                            '2654',
                            '3467',
                            '4295',
                            '4828',
                            '5129',
                            '1021',
                            '1271',
                            '1287',
                            '1291',
                            '1292',
                            '1833',
                            '3468',
                            '4739',
                            '5130',
                            'B863',
                            '0851',
                            '0867',
                            '1263',
                            '1268',
                            '1280',
                            '1283',
                            '1295',
                            '1300',
                            '1301',
                            '1302',
                            '1311',
                            '1313',
                            '0852',
                            '0862',
                            '4250',
                            '1270',
                            '1281',
                            '1284',
                            '1285',
                            '1297',
                            '1309',
                            '1316',
                            '4836',
                            'B864',
                            '0983',
                            '1267',
                            '1277',
                            '1282',
                            '1294',
                            '1308',
                            '6633',
                            '2655',
                            '3396',
                            '6632',
                            '8369',
                            '0848',
                            '1002',
                            '1273',
                            '1288',
                            '1296',
                            '1315',
                            '2679',
                            '4271',
                            '4858',
                            '6902',
                            '6917',
                            '6939',
                            '8359',
                            '8367',
                            '4621',
                            '4627',
                            '5144',
                            '4624',
                            '5136',
                            '5140',
                            '5147',
                            'M808',
                            '4580',
                            '4599',
                            '4603',
                            '4623',
                            '4625',
                            '5134',
                            '4597',
                            '4601',
                            '4602',
                            '5132',
                            '5135',
                            '5139',
                            '4255',
                            '4598',
                            '4601',
                            '5146',
                            '4579',
                            '4622',
                            '5137',
                            '3270',
                            '3275',
                            '1453',
                            '3277',
                            '1443',
                            '3276',
                            '3274',
                            '1444',
                            '1445',
                            '1454',
                            '1184',
                            '6638',
                            '3456',
                            '6641',
                            '6642',
                            '6640',
                            '6643',
                            '3459',
                            '6639',
                            '1785',
                            '4734',
                            'B904',
                            '1790',
                            '4729',
                            'B902',
                            'B906',
                            'B912',
                            'B916',
                            'B923',
                            'B932',
                            'B907',
                            'B908',
                            'B915',
                            'B936',
                            '1794',
                            '1818',
                            'B926',
                            'B884',
                            'B901',
                            'B940',
                            '1780',
                            'B885',
                            'B905',
                            'B917',
                            'B919',
                            'B909',
                            'B920',
                            '1528',
                            '1639',
                            '1615',
                            '1525',
                            '1614',
                            '4114',
                            '4313',
                            '4312',
                            '2534',
                            '3750',
                            '2526',
                            '3214',
                            '3756',
                            '3769',
                            '3741',
                            '3751',
                            '3752',
                            'E103',
                            '3742',
                            '3254',
                            '3749',
                            '3755',
                            'U202',
                            '3215',
                            '3218',
                            '3724',
                            '3757',
                            '3146',
                            '3226',
                            '3748',
                            '3758',
                            '3770',
                            '3740',
                            '3744',
                            '3745',
                            '3746',
                            '3747',
                            '3743',
                            '3754',
                            '3759',
                            '0559',
                            '0565',
                            '0590',
                            '0599',
                            '0606',
                            '0676',
                            '0679',
                            '0695',
                            '1113',
                            '0591',
                            '0661',
                            '0670',
                            '0680',
                            '0687',
                            '0691',
                            '0692',
                            '1099',
                            '1104',
                            '1132',
                            '2540',
                            '6842',
                            '7055',
                            'B831',
                            '0545',
                            '0549',
                            '0551',
                            '0607',
                            '0656',
                            '0657',
                            '0658',
                            '0660',
                            '0673',
                            '0678',
                            '0682',
                            '0685',
                            '1407',
                            '2536',
                            '0582',
                            '0597',
                            '0604',
                            '0605',
                            '0662',
                            '0689',
                            '0690',
                            '0608',
                            '0655',
                            '0666',
                            '0674',
                            '0684',
                            '0688',
                            '2535',
                            '0654',
                            '0672',
                            '0677',
                            '0696',
                            '0556',
                            '0592',
                            'B828',
                            '1107',
                            '1131',
                            '2541',
                            '2544',
                            '2580',
                            '0621',
                            '0659',
                            '0668',
                            '0671',
                            '0675',
                            '0681',
                            '0686',
                            '2543',
                            '2642',
                            '6841',
                            '6843',
                            '0540',
                            '0550',
                            '0583',
                            '0598',
                            '0664',
                            '0665',
                            '0667',
                            '0669',
                            '0683',
                            'B830',
                            '2643',
                            'B829',
                            'B827',
                            '1080',
                            'B832',
                            '2522',
                            '1595',
                            '1597',
                            '1556',
                            '1596',
                            '2004',
                            '1561',
                            '1562',
                            '1560',
                            '8507',
                            '5178',
                            '5181',
                            '5183',
                            '5027',
                            '5167',
                            '6717',
                            '5028',
                            '5181',
                            'M812',
                            '5028',
                            '5182',
                            '5197',
                            '5376',
                            '6719',
                            '7103',
                            '7143',
                            'B814',
                            'B816',
                            'B817',
                            'B819',
                            'B819',
                            '7057',
                            '7933',
                            '7934',
                            '5538',
                            '5585',
                            '7069',
                            '7933',
                            'B818',
                            '7019',
                            '7058',
                            '7071',
                            '7072',
                            '7073',
                            '7104',
                            'B826',
                            'B942',
                            '7083',
                            '7187',
                            'B815',
                            '7058',
                            '7142',
                            '5585',
                            '5587',
                            '7021',
                            '7024',
                            '7057',
                            '7082',
                            '5538',
                            '7060',
                            '7069',
                            '1335',
                            '1349',
                            '1353',
                            '1340',
                            'A003',
                            'A006',
                            '1348',
                            '1326',
                            '1341',
                            '1349',
                            '1350',
                            '1594',
                            'A007',
                            '1335',
                            'A002',
                            'A005',
                            'A012',
                            'A009',
                            '1351',
                            '1379',
                            '1379',
                            'A004',
                            'A008',
                            'A010',
                            '5131',
                            '5131',
                            '5128',
                            '5122',
                            '5126',
                            '5124',
                            '5127',
                            '5127',
                            '5126',
                            '5321',
                            '1152',
                            '1210',
                            '2780',
                            '2784',
                            '3135',
                            '1146',
                            '2754',
                            '2760',
                            '2778',
                            '2800',
                            '3449',
                            '1141',
                            '1210',
                            '2787',
                            '2880',
                            '3219',
                            '3447',
                            '1809',
                            '2776',
                            '2782',
                            '2787',
                            '2810',
                            '3049',
                            '3448',
                            '1141',
                            '2683',
                            '2684',
                            '2757',
                            '3444',
                            '2762',
                            '1152',
                            '1169',
                            '2785',
                            '3445',
                            '3446',
                            '3448',
                            '1169',
                            '1408',
                            '1809',
                            '2760',
                            '1906',
                            '9120',
                            '1907',
                            '9119',
                            '9121',
                            '1905',
                            '1911',
                            '4020',
                            '5089',
                            '4006',
                            '4010',
                            '4019',
                            '5079',
                            '0954',
                            '4788',
                            '5069',
                            '5074',
                            '5082',
                            '5084',
                            '5100',
                            '4020',
                            '5073',
                            '5079',
                            '5081',
                            '5083',
                            '5085',
                            '5092',
                            '5094',
                            '0719',
                            '0721',
                            '4009',
                            '5075',
                            '5088',
                            '5095',
                            '5674',
                            '0812',
                            '4010',
                            '5078',
                            '5090',
                            '5089',
                            '0811',
                            '0914',
                            '0918',
                            '5065',
                            '5066',
                            '5068',
                            '5070',
                            '5087',
                            '5067',
                            '5072',
                            '5077',
                            '5080',
                            '5091',
                            '7084',
                            '0917',
                            '5068',
                            '5071',
                            '5097',
                            '5066',
                            '2455',
                            '3120',
                            '2462',
                            '3171',
                            '3522',
                            '3886',
                            '3963',
                            '2648',
                            '2940',
                            '4238',
                            '4239',
                            '4241',
                            '4242')*/

          ---------- ******************* SPECIFY LIST OF MASTER PRODUCTS OR LEAVE OUT ***************
          --AND DPP."KEY" IN ('233275', '233272', '107052', '239421', '785807', '455433', '73175', '3891315', '682975', '524527', '2484334', '2484430', '15739', '2027158', '503792', '528153', '4882365', '3265845', '18431', '285515', '21564', '406612', '4137', '21995', '2050997', '5133745', '84370', '7097', '3866437', '3763357', '3622651', '4107707', '3986618', '9023', '3986602', '3986588', '253043', '2114954', '2113988')

          GROUP BY DPP.OBSOLETE,
                   DPP.PER,
                   DPP.LISTPRICE,
                   DPP.BASIS1,
                   DPP.BASIS2,
                   DPP.BASIS3,
                   DPP.BASIS4,
                   DPP.BASIS5,
                   DPP.BASIS6,
                   --DPP.BASIS7,
                   --DPP.BASIS8,
                   --DPP.BASIS9,
                   DPP."KEY",
                   DPP.ALT1,
                   DPP.VENCODE,
                   DPP."DESC",
                   DPP.LINE,
                   CASE
                      WHEN COALESCE (LTRIM (RTRIM (STATUS)), 'ST') IN
                              ('ST', 'NQ', 'S')
                      THEN
                         'DC_STOCK'
                      WHEN     WHSE = '39'
                           AND "KEY" NOT IN
                                  (SELECT DISTINCT "KEY"
                                   FROM SALES_MART.DIST_PRODUCT_PRICING
                                   WHERE COALESCE (LTRIM (RTRIM (STATUS)),
                                                   'ST') IN
                                            ('ST', 'NQ', 'S'))
                      THEN
                         'SOD'
                      ELSE
                         NULL
                   END,
                   DPP."GROUP")
    WHERE ORDER_METHOD IS NOT NULL);

COMMIT;