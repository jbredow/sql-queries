/*  
	**  Change the tablename to current month 
	For overrides about to expire unremark "--AND CCORG.EXPIRE_DATE > SYSDATE"
	To get all overrides you need that remmed
*/
--full customer contract override download(12 Month)
DROP TABLE AAA6863.A_CCOR_CENT_201406;

CREATE TABLE AAA6863.A_CCOR_CENT_201406 AS

select * from 
	(SELECT DISTINCT CONTACTS.RPC,
		CONTACTS.DISTRICT,
		CCORG.BRANCH_NUMBER_NK,
		CONTACTS.ALIAS,
		CCORG.CUSTOMER_NK,
		CCORG.CONTRACT_ID,
		CCORG.OVERRIDE_ID_NK,
		CCORG.OVERRIDE_TYPE,
		CCORG.DISC_GROUP DG,
		DG.DISCOUNT_GROUP_NAME,
		NULL AS ALT1_CODE,
		NULL AS PRODUCT_NAME,
		CCORG.EXPIRE_DATE,
		CCORG.BASIS,
		CCORG.OPERATOR_USED,
		CCORG.MULTIPLIER,
		CCORG.INSERT_TIMESTAMP,
		CCORG.UPDATE_TIMESTAMP,
		CCORG.LAST_UPDATE,
		CCORG.DELETE_DATE

	FROM DW_FEI.CUSTOMER_OVERRIDE_DIMENSION CCORG,
		 DW_FEI.DISCOUNT_GROUP_DIMENSION DG,
		 AAF1046.BRANCH_CONTACTS CONTACTS
		 
	WHERE CCORG.DISC_GROUP = DG.DISCOUNT_GROUP_NK
		AND CONTACTS.ACCOUNT_NK = CCORG.BRANCH_NUMBER_NK
		AND CCORG.OVERRIDE_TYPE = 'G'
		--AND CCORG.EXPIRE_DATE > SYSDATE
		AND CCORG.DELETE_DATE IS NULL
		AND CONTACTS.RPC = 'Midwest'
		
	UNION

	--Old Product CCORs (12 Month)
	SELECT DISTINCT CONTACTS.RPC,
		CONTACTS.DISTRICT,
		CCORP.BRANCH_NUMBER_NK,
		CONTACTS.ALIAS,
		CCORP.CUSTOMER_NK,
		CCORP.CONTRACT_ID,
		CCORP.OVERRIDE_ID_NK,
		CCORP.OVERRIDE_TYPE,
		PROD.DISCOUNT_GROUP_NK dg,
		DG.DISCOUNT_GROUP_NAME,
		PROD.ALT1_CODE,
		PROD.PRODUCT_NAME,
		CCORP.EXPIRE_DATE,
		CCORP.BASIS,
		CCORP.OPERATOR_USED,
		CCORP.MULTIPLIER,
		CCORP.INSERT_TIMESTAMP,
		CCORP.UPDATE_TIMESTAMP,
		CCORP.LAST_UPDATE,
		CCORP.DELETE_DATE
		
	FROM DW_FEI.CUSTOMER_OVERRIDE_DIMENSION CCORP,
		 DW_FEI.PRODUCT_DIMENSION PROD,
		 DW_FEI.DISCOUNT_GROUP_DIMENSION DG,
		 AAF1046.BRANCH_CONTACTS CONTACTS
		 
	WHERE CCORP.MASTER_PRODUCT 		= PROD.PRODUCT_NK
		AND PROD.DISCOUNT_GROUP_NK 	= DG.DISCOUNT_GROUP_NK
		AND CONTACTS.ACCOUNT_NK 	= CCORP.BRANCH_NUMBER_NK
		AND CCORP.OVERRIDE_TYPE 	= 'P'
		--AND CCORP.EXPIRE_DATE 	  > SYSDATE
		AND CCORP.DELETE_DATE 	   IS NULL
		AND CONTACTS.RPC 			= 'Midwest'
	) xx
		/*WHERE XX.DISTRICT = 'C11'
		 AND xx.dg IN(
			'999', '1003', '1005', '1007', '1011', 
			'1015', '1017', '1025', '1026', '1027') */
;

GRANT SELECT ON AAA6863.A_CCOR_CENT_201406 TO PUBLIC;	
	
SELECT * FROM AAA6863.A_CCOR_CENT_201406 CCOR WHERE CCOR.DISTRICT = 'C10';